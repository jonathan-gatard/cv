---
import Layout from '../../layouts/Layout.astro';
---

<Layout title="Domotique & Smart Home" description="D√©tails de mon installation domotique compl√®te : Zigbee, Home Assistant, Node-Red, etc.">
  <div class="max-w-4xl mx-auto px-4 py-12 text-gray-300">
    
    <a href="/passions" class="inline-flex items-center text-blue-400 hover:text-blue-300 mb-8 transition-colors">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
        <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd" />
      </svg>
      Retour aux passions
    </a>

    <h1 class="text-4xl font-bold text-white mb-6">Domotique & Smart Home</h1>
    <p class="text-xl text-gray-400 mb-12">Domotisation compl√®te de mon habitation (2020 - aujourd'hui)</p>

    <div class="space-y-16">
      
      <!-- Intro & Objectifs -->
      <section>
        <h2 class="text-2xl font-semibold text-white mb-4 border-l-4 border-blue-500 pl-4">Objectifs & Philosophie</h2>
        <p class="mb-6">
          Automatiser une habitation en utilisant une solution <strong>universelle, modulable, gratuite et open-source</strong>.
          L'objectif est de s'affranchir des cloud propri√©taires et de garder le contr√¥le total des donn√©es.
        </p>
        <div class="grid md:grid-cols-2 gap-6">
            <div class="bg-gray-800 p-6 rounded-lg border border-green-900/50">
                <h3 class="text-lg font-bold text-green-400 mb-3">Avantages</h3>
                <ul class="list-disc list-inside space-y-2 text-sm">
                    <li>Ind√©pendance totale (Cloud-free)</li>
                    <li>Co√ªt tr√®s avantageux (Hardware DIY)</li>
                    <li>Fiabilit√© √©lev√©e et mises √† jour fr√©quentes</li>
                    <li>Apprentissage technique constant (R√©seau, Linux, MQTT)</li>
                </ul>
            </div>
             <div class="bg-gray-800 p-6 rounded-lg border border-red-900/50">
                <h3 class="text-lg font-bold text-red-400 mb-3">Inconv√©nients</h3>
                <ul class="list-disc list-inside space-y-2 text-sm">
                    <li>Temps de mise en place cons√©quent</li>
                    <li>N√©cessite des comp√©tences techniques vari√©es</li>
                </ul>
            </div>
        </div>
      </section>

      <!-- ZigBee -->
      <section>
        <h2 class="text-2xl font-semibold text-white mb-6 border-l-4 border-blue-500 pl-4">R√©seau ZigBee</h2>
        <p class="mb-4">
            Utilisation du protocole ZigBee pour sa faible consommation et son maillage r√©seau.
            Mat√©riel : Valves thermostatiques Tuya, Capteurs Xiaomi (Temp/Hum/Porte/Pr√©sence), etc.
        </p>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
             <div class="bg-gray-800 rounded-lg overflow-hidden">
                <div class="bg-gray-300 flex items-center justify-center h-48">
                  <img src="/images/projects/domotique/xiaomi1.jpg" alt="Capteur Xiaomi" class="w-full h-48 object-contain mix-blend-multiply">
                </div>
                <div class="p-3 text-center text-sm font-medium">Capteurs Temp/Hum</div>
             </div>
             <div class="bg-gray-800 rounded-lg overflow-hidden">
                <div class="bg-gray-300 flex items-center justify-center h-48">
                  <img src="/images/projects/domotique/xiaomi2.jpg" alt="Capteur Porte" class="w-full h-48 object-contain mix-blend-multiply">
                </div>
                <div class="p-3 text-center text-sm font-medium">Capteurs d'ouverture</div>
             </div>
             <div class="bg-gray-800 rounded-lg overflow-hidden">
                <div class="bg-gray-300 flex items-center justify-center h-48">
                  <img src="/images/projects/domotique/tuya.jpg" alt="Valve Tuya" class="w-full h-48 object-contain mix-blend-multiply">
                </div>
                <div class="p-3 text-center text-sm font-medium">Vannes Thermostatiques</div>
             </div>
        </div>
      </section>

      <!-- Sniffer Zigbee & RPI -->
      <section>
         <h2 class="text-2xl font-semibold text-white mb-6 border-l-4 border-blue-500 pl-4">Infrastructure Serveur</h2>
         <p class="mb-4">
            Pour contr√¥ler le tout, j'utilise un <strong>Raspberry Pi 4</strong> √©quip√© d'un module sniffer <strong>PiZigate</strong>.
            C'est le coeur du syst√®me.
         </p>
         <div class=" bg-gray-600 rounded-lg p-6 mb-6">
            <h3 class="font-bold text-white mb-2">Challenges techniques :</h3>
            <ul class="list-disc list-inside space-y-1 text-sm text-gray-200">
                <li>Mapper le port s√©rie <code>/dev/ttyAMA0</code> vers le conteneur Docker</li>
                <li>Flasher le firmware de la PiZigate pour supporter le d√©bit 115200 big-endian</li>
                <li>S√©curisation avec <strong>Fail2Ban</strong> (protection SSH) et <strong>Nginx Proxy Manager</strong></li>
            </ul>
         </div>
         <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
             <div class="bg-gray-800 rounded-lg overflow-hidden">
                <img src="/images/projects/domotique/pizigate.jpg" alt="Raspberry Pi" class="w-full h-64 object-cover">
                <div class="p-4">
                    <h4 class="font-bold text-white">Le Serveur</h4>
                    <p class="text-sm">Boitier Argon One, SSD M.2 120Go, Onduleur UPS.</p>
                </div>
             </div>
              <div class="bg-gray-800 rounded-lg overflow-hidden border border-gray-700 p-4 flex flex-col justify-center">
                  <h4 class="font-bold text-white mb-3 text-lg">Stack Logicielle (Docker)</h4>
                  <ul class="space-y-2 text-sm text-gray-300">
                    <li class="flex items-center"><span class="w-3 h-3 bg-blue-500 rounded-full mr-2"></span>Home Assistant (Core)</li>
                    <li class="flex items-center"><span class="w-3 h-3 bg-yellow-500 rounded-full mr-2"></span>Zigbee2MQTT (Bridge Zigbee &harr; MQTT)</li>
                    <li class="flex items-center"><span class="w-3 h-3 bg-purple-500 rounded-full mr-2"></span>Mosquitto (Broker MQTT)</li>
                    <li class="flex items-center"><span class="w-3 h-3 bg-red-500 rounded-full mr-2"></span>Node-Red (Automatisations complexes)</li>
                    <li class="flex items-center"><span class="w-3 h-3 bg-green-500 rounded-full mr-2"></span>InfluxDB + Grafana (M√©triques & Logs)</li>
                    <li class="flex items-center"><span class="w-3 h-3 bg-gray-500 rounded-full mr-2"></span>Portainer (Gestion Docker)</li>
                  </ul>
             </div>
         </div>
      </section>

      <!-- Node Red & Automation -->
      <section>
        <h2 class="text-2xl font-semibold text-white mb-6 border-l-4 border-blue-500 pl-4">Automatisations Avanc√©es (Node-Red)</h2>
        <p class="mb-6">
            Je pr√©f√®re Node-Red aux automatisations natives de Home Assistant pour sa puissance visuelle et sa capacit√© √† g√©rer des logiques complexes.
        </p>

        <div class="space-y-8">
            <div class="bg-gray-800 rounded-lg overflow-hidden">
                <img src="/images/projects/domotique/nodered.jpg" alt="Flow Chauffage" class="w-full object-contain bg-white/5">
                <div class="p-4">
                    <h4 class="font-bold text-white mb-2">Exemple : Flow de Chauffage</h4>
                    <p class="text-sm">
                        Gestion intelligente qui croise plannings horaires, d√©tection de pr√©sence, et ouverture des fen√™tres pour optimiser la consommation.
                        Ajuste la temp√©rature cible dynamiquement selon des variables globales d√©finies dans Home Assistant.
                    </p>
                </div>
            </div>

            <div class="bg-gray-800 rounded-lg overflow-hidden">
                <img src="/images/projects/domotique/nodered2.jpg" alt="Flow Pr√©sence" class="w-full object-contain bg-white/5">
                <div class="p-4">
                    <h4 class="font-bold text-white mb-2">Exemple : Gestion de l'√©clairage</h4>
                    <p class="text-sm">
                        Allumage adaptatif selon la luminosit√© ambiante (capteur Lux) et l'heure de la journ√©e (Cycle Circadien : lumi√®re froide le matin, chaude le soir).
                        Verrouillage manuel possible pour cr√©er des ambiances.
                    </p>
                </div>
            </div>
        </div>
      </section>

      <!-- √âvolution : du Raspberry Pi au NUC -->
      <section>
        <h2 class="text-2xl font-semibold text-white mb-6 border-l-4 border-blue-500 pl-4">√âvolution : du Raspberry Pi au NUC</h2>
        <p class="mb-6">
            Avec la multiplication des services (Frigate, Grafana, bases de donn√©es, musique...), le Raspberry Pi 4 a atteint ses limites.
            J'ai migr√© l'ensemble sur un <strong>Intel NUC</strong>, bien plus puissant et fiable.
        </p>

        <div class="grid md:grid-cols-2 gap-6 mb-6">
            <div class="bg-gray-800 p-6 rounded-lg border border-red-900/30">
                <h3 class="font-bold text-red-400 mb-3">üî¥ Avant (RPi4)</h3>
                <ul class="text-sm space-y-1 text-gray-400">
                    <li>‚Ä¢ CPU ARM 4 c≈ìurs ‚Äî limit√© pour Frigate</li>
                    <li>‚Ä¢ SSD M.2 120 Go via USB</li>
                    <li>‚Ä¢ PiZigate soud√©e (port s√©rie)</li>
                    <li>‚Ä¢ ~10 conteneurs Docker</li>
                </ul>
            </div>
            <div class="bg-gray-800 p-6 rounded-lg border border-green-900/30">
                <h3 class="font-bold text-green-400 mb-3">üü¢ Maintenant (NUC)</h3>
                <ul class="text-sm space-y-1 text-gray-400">
                    <li>‚Ä¢ CPU x86 Intel ‚Äî puissance largement suffisante</li>
                    <li>‚Ä¢ SSD NVMe + stockage donn√©es</li>
                    <li>‚Ä¢ Coordinateur ZigBee USB (Sonoff dongle)</li>
                    <li>‚Ä¢ ~25 conteneurs Docker (HA, Frigate, Grafana, PostgreSQL, Mail...)</li>
                </ul>
            </div>
        </div>

        <div class="bg-gray-800 rounded-lg p-6 border border-gray-700">
            <h4 class="font-bold text-white mb-3 text-lg">Stack Docker actuelle</h4>
            <div class="grid grid-cols-2 md:grid-cols-3 gap-2 text-sm text-gray-300">
                <span class="flex items-center"><span class="w-2 h-2 bg-blue-500 rounded-full mr-2"></span>Home Assistant</span>
                <span class="flex items-center"><span class="w-2 h-2 bg-yellow-500 rounded-full mr-2"></span>Zigbee2MQTT</span>
                <span class="flex items-center"><span class="w-2 h-2 bg-purple-500 rounded-full mr-2"></span>Mosquitto (MQTT)</span>
                <span class="flex items-center"><span class="w-2 h-2 bg-red-500 rounded-full mr-2"></span>Node-Red</span>
                <span class="flex items-center"><span class="w-2 h-2 bg-green-500 rounded-full mr-2"></span>Grafana + InfluxDB</span>
                <span class="flex items-center"><span class="w-2 h-2 bg-cyan-500 rounded-full mr-2"></span>Frigate (vid√©o IA)</span>
                <span class="flex items-center"><span class="w-2 h-2 bg-teal-500 rounded-full mr-2"></span>AdGuard Home</span>
                <span class="flex items-center"><span class="w-2 h-2 bg-orange-500 rounded-full mr-2"></span>Nginx Proxy Manager</span>
                <span class="flex items-center"><span class="w-2 h-2 bg-gray-400 rounded-full mr-2"></span>Portainer</span>
                <span class="flex items-center"><span class="w-2 h-2 bg-indigo-500 rounded-full mr-2"></span>PostgreSQL (Scribe)</span>
                <span class="flex items-center"><span class="w-2 h-2 bg-pink-500 rounded-full mr-2"></span>Music Assistant</span>
                <span class="flex items-center"><span class="w-2 h-2 bg-amber-500 rounded-full mr-2"></span>Mailu (Email)</span>
            </div>
        </div>
      </section>

      <!-- Dashboarding -->
      <section>
          <h2 class="text-2xl font-semibold text-white mb-6 border-l-4 border-blue-500 pl-4">Monitoring & Visualisation</h2>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div>
                   <h3 class="font-bold text-lg mb-2">Grafana + InfluxDB</h3>
                   <p class="text-sm text-gray-400 mb-4">Stockage √† long terme des m√©triques (temp√©ratures, consommation, humidit√©) pour analyser les tendances.</p>
                   <img src="/images/projects/domotique/grafana.jpg" class="rounded-lg shadow-lg border border-gray-700" alt="Grafana">
              </div>
               <div>
                   <h3 class="font-bold text-lg mb-2">Home Assistant (Lovelace)</h3>
                   <p class="text-sm text-gray-400 mb-4">Dashboard tactile utilis√© au quotidien sur tablette murale et smartphone pour le contr√¥le direct.</p>
                   <img src="/images/projects/domotique/ha.jpg" class="rounded-lg shadow-lg border border-gray-700" alt="Home Assistant">
              </div>
          </div>
      </section>

    </div>
  </div>
</Layout>
