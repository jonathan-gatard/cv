---
const colorMap: Record<string, string> = {
  blue: "text-blue-400 border-blue-500/30 bg-blue-500/10",
  purple: "text-purple-400 border-purple-500/30 bg-purple-500/10",
  green: "text-green-400 border-green-500/30 bg-green-500/10",
  yellow: "text-yellow-400 border-yellow-500/30 bg-yellow-500/10",
  pink: "text-pink-400 border-pink-500/30 bg-pink-500/10",
  cyan: "text-cyan-400 border-cyan-500/30 bg-cyan-500/10",
};

const experiences = [
    {
        role: `Ingénieur Mainframe & Interopérabilité`,
        company: `Solutec & CAGIP (Rodez)`,
        date: `Sept 2023 - Aujourd'hui`,
        description: `Garantir le maintien en condition opérationnelle, assurer le rôle d'AppOps et piloter les projets de modernisation du mainframe.`,
        tags: [
            { name: `Mainframe`, color: `blue` },
            { name: `z/OS`, color: `blue` },
            { name: `USS`, color: `blue` },
            { name: `MCO`, color: `blue` },
            { name: `Python`, color: `purple` },
            { name: `Ansible`, color: `green` },
            { name: `AppOps`, color: `green` },
            { name: `Zowe`, color: `blue` },
            { name: `VSCode`, color: `purple` },
            { name: `API`, color: `purple` },
            { name: `Cobol`, color: `blue` },
            { name: `JCL`, color: `blue` },
            { name: `Rexx`, color: `blue` },
            { name: `Astreintes`, color: `blue` }
        ],
        details: [
            {
                title: `MCO & Expertise z/OS`,
                content: `Installation et maintenance de matière mainframe pour CA-TS.
Maîtrise de l'environnement USS (Z Linux)
Garantie de la disponibilité et de la performance des environnements critiques.
Astreintes : Résolution de jobs plantés, analyse de problèmes de stockage, modification de fichiers applicatifs en urgence.`
            },
            {
                title: `Build & Modernisation`,
                content: `Pilotage d'un projet majeur d'appels API depuis le Mainframe vers des servitudes techniques sur VMs.
Pilote sur le déploiement de Zowe et VSCode pour moderniser l'expérience développeur.
Automatisation de l'installation de matière logicielle CATS on Mainframe.
Développement d'outils en Python pour automatiser les tâches d'exploitation récurrentes.`,
            },
            {
                title: `AppOps & Projets Squads`,
                content: `Expert technique CA-TS : pont entre besoins applicatifs et exigences opérationnelles mainframe.
Développement d'outils de gestion des logs pour des squads techniques.
Création de Playbooks Ansible pour applications de développement cobol.`
            }
        ]
    },
    {
        role: `Manager Projets & Ingénieur DevOps`,
        company: `Stellantis (Slovaquie)`,
        date: `2021 - 2023`,
        description: `Pilotage de projets IT industriels et transformation numérique.`,
        tags: [
            { name: `Management`, color: `yellow` },
            { name: `DevOps`, color: `green` },
            { name: `React`, color: `purple` },
            { name: `NodeJS`, color: `purple` },
            { name: `Docker`, color: `green` },
            { name: `CI/CD`, color: `green` },
            { name: `Grafana`, color: `green` },
            { name: `PowerBI`, color: `yellow` },
            { name: `Node-Red`, color: `green` },
            { name: `Fullstack`, color: `purple` },
            { name: `Agile`, color: `yellow` },
            { name: `Scrum`, color: `yellow` }
        ],
        details: [
            {
                title: `Management & Pilotage`,
                content: `Encadrement d'une équipe de 4 personnes.
Gestion de projets de collecte de données industrielles et reporting PowerBI.`
            },
            {
                title: `Développement & Automatisation`,
                content: `Développement web fullstack (React/NodeJS) pour la gestion RH et industrielle.
Mise en place de pipelines CI/CD et monitoring (Grafana, Node-Red).`
            }
        ]
    },
    {
        role: `Ingénieur Projets Logistique & Amélioration Continue`,
        company: `LISI Aerospace (Parthenay)`,
        date: `2016 - 2021`,
        description: `Optimisation de flux et conduite de projets industriels majeurs.`,
        tags: [
            { name: `Logistique`, color: `yellow` },
            { name: `Lean`, color: `yellow` },
            { name: `Amélioration Continue`, color: `yellow` },
            { name: `Gestion de Projet`, color: `yellow` },
            { name: `VB.NET`, color: `purple` },
            { name: `VSM`, color: `yellow` },
            { name: `5S`, color: `yellow` },
            { name: `PDCA`, color: `yellow` },
            { name: `Industrie`, color: `pink` },
            { name: `Flux`, color: `yellow` }
        ],
        details: [
            {
                title: `Projets Industriels`,
                content: `Implantation de nouvelles zones logistiques pour la construction de deux usines neuves.
Développement d'outils de gestion en VB.NET.`
            },
            {
                title: `Amélioration Continue`,
                content: `Mise en place d'outils Lean (5S, VSM, PDCA).
Amélioration de la satisfaction client et optimisation des flux logistiques.`
            }
        ]
    }
];

const education = [
    {
        role: `Sécurité & Réseaux (Autodidacte)`,
        company: `TU Graz (Autriche)`,
        date: `2022`,
        description: `Suivi de cours en autonomie, sur les thématiques de sécurité réseau et systèmes.`,
        tags: [
            { name: `Network Security`, color: `green` },
            { name: `CTF`, color: `cyan` },
            { name: `Intelligence Artificielle`, color: `purple` },
            { name: `AR/VR`, color: `cyan` },
            { name: `Unity`, color: `purple` },
            { name: `OpenCV`, color: `purple` }
        ],
        details: [
            {
                title: `Cursus`,
                content: `Sécurité réseau
Capture The Flag (CTF)
Intelligence artificielle
Réalité Augmentée (OpenCV / Unity)`
            }
        ]
    },
    {
        role: `Ingénieur Aéronautique & Spatial (Alternance)`,
        company: `CNAM / ISAE-Supaero / ISAE-ENSMA`,
        date: `2016 - 2019`,
        description: `Diplôme d'ingénieur obtenu en alternance. Cursus réparti sur 3 écoles.`,
        tags: [
            { name: `Ingénierie`, color: `pink` },
            { name: `Aéronautique`, color: `pink` },
            { name: `Spatial`, color: `pink` },
            { name: `Matériaux Composites`, color: `pink` },
            { name: `Mécanique des fluides`, color: `pink` },
            { name: `Alternance`, color: `yellow` },
            { name: `CAO`, color: `pink` }
        ],
        details: [
            {
                title: `CNAM, Poitiers`,
                content: `Fondamentaux de l'ingénierie.
Sciences industrielles et gestion de projet.`
            },
            {
                title: `ISAE-Supaero, Toulouse`,
                content: `Formation intensive en ingénierie aéronautique et spatiale.
Mécanique des fluides et résistance des matériaux.`
            },
            {
                title: `ISAE-ENSMA, Poitiers`,
                content: `Spécialisation en thermodynamique.`
            }
        ]
    },
    {
        role: `Stage International`,
        company: `Malaisie`,
        date: `2018 (3 mois)`,
        description: `Stage de découverte dans une école de cuisine en Malaisie. Immersion linguistique et culturelle.`,
        tags: [
            { name: `Anglais`, color: `yellow` },
            { name: `International`, color: `yellow` },
            { name: `Ouverture culturelle`, color: `yellow` },
            { name: `Immersion`, color: `yellow` }
        ],
        details: [
            {
                title: `Objectifs`,
                content: `Perfectionnement de l'anglais en immersion totale.
Découverte d'un environnement professionnel international.`
            }
        ]
    },
    {
        role: `DUT Science et Génie des Matériaux`,
        company: `IUT Nantes`,
        date: `2014 - 2016`,
        description: `Formation technique en science des matériaux et procédés industriels.`,
        tags: [
            { name: `Matériaux`, color: `pink` },
            { name: `Composites`, color: `pink` },
            { name: `Procédés industriels`, color: `pink` },
            { name: `Métaux`, color: `pink` },
            { name: `Polymères`, color: `pink` },
            { name: `Physique`, color: `pink` },
            { name: `Chimie`, color: `pink` }
        ],
        details: [
            {
                title: `Formation`,
                content: `Étude approfondie des matériaux (métaux, polymères, composites).
Procédés de mise en forme et caractérisation mécanique.`
            }
        ]
    }
];

// Build sidebar items with sub-entries
const sidebarSections = [
  {
    id: 'experience',
    label: 'Expérience',
    children: experiences.map((exp, i) => ({ id: `exp-${i}`, label: exp.company.split('(')[0].trim() }))
  },
  {
    id: 'formation',
    label: 'Formation',
    children: education.map((edu, i) => ({ id: `edu-${i}`, label: edu.company.split('(')[0].trim() }))
  },
];

const cardItems = [
  { id: 'experience', title: 'Expériences professionnelles', items: experiences, prefix: 'exp' },
  { id: 'formation', title: 'Formations', items: education, prefix: 'edu' },
];


---

<div class="bg-gray-900 text-white pt-24 pb-16">
  <div class="max-w-7xl mx-auto px-4 flex gap-0 md:gap-8">

    <!-- Sticky Sidebar (Desktop only) -->
    <aside class="hidden lg:block w-56 shrink-0">
      <nav class="sticky top-28 space-y-1" id="sidebar-nav">
        {sidebarSections.map(s => (
          <div>
            <a href={`#${s.id}`} data-section={s.id}
               class="sidebar-link block px-4 py-2.5 text-sm font-medium text-gray-500 rounded-lg border-l-2 border-transparent hover:text-white hover:bg-gray-800/50 transition-all">
              {s.label}
            </a>
            {s.children.length > 0 && (
              <div class="ml-4 mt-0.5 space-y-0.5">
                {s.children.map(child => (
                   <a href={`#${child.id}`} data-section={child.id}
                      class="sidebar-link block px-3 py-1.5 text-xs text-gray-600 rounded-md border-l-2 border-transparent hover:text-gray-300 hover:bg-gray-800/30 transition-all truncate">
                    {child.label}
                  </a>
                ))}
              </div>
            )}
          </div>
        ))}
      </nav>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 min-w-0">

      <!-- Legend & Introduction -->
      <section class="mb-12 space-y-8">
        <div class="bg-blue-600/10 border border-blue-500/20 p-8 rounded-2xl shadow-2xl backdrop-blur-sm">
          <h1 class="text-4xl font-extrabold text-white mb-4 tracking-tight">Ingénieur Mainframe & Interopérabilité</h1>
          <p class="text-xl text-gray-300 leading-relaxed italic">
            "Ma double compétence en <strong>Mainframe</strong> et <strong>Open</strong> me permet de moderniser les infrastructures historiques en y intégrant les meilleures pratiques d'automatisation et d'agilité."
          </p>
        </div>

        <!-- Tag Legend -->
        <div class="bg-gray-800/40 border border-gray-700/50 p-6 rounded-2xl backdrop-blur-sm">
            <h3 class="text-sm font-semibold text-gray-400 uppercase tracking-wider mb-4">Légende des compétences</h3>
            <div class="flex flex-wrap gap-4 text-xs font-bold">
                <span class={`px-3 py-1.5 rounded-full border ${colorMap.blue}`}>Mainframe & Systèmes</span>
                <span class={`px-3 py-1.5 rounded-full border ${colorMap.purple}`}>Dév & Logiciel</span>
                <span class={`px-3 py-1.5 rounded-full border ${colorMap.green}`}>Infra, Cloud & DevOps</span>
                <span class={`px-3 py-1.5 rounded-full border ${colorMap.yellow}`}>Pilotage & Soft Skills</span>
                <span class={`px-3 py-1.5 rounded-full border ${colorMap.pink}`}>Industrie & Ingénierie</span>
                <span class={`px-3 py-1.5 rounded-full border ${colorMap.cyan}`}>IoT & Maker</span>
            </div>
        </div>
      </section>

      {cardItems.map(section => (
        <section id={section.id} class="mb-20">
          <h2 class="text-3xl font-bold mb-10 bg-clip-text text-transparent bg-gradient-to-r from-blue-400 to-purple-500">
            {section.title}
          </h2>

          <div class="space-y-6">
            {section.items.map((item, i) => (
              <div id={`${section.prefix}-${i}`} class="bg-gray-800/50 p-5 rounded-xl border border-gray-700/50 hover:border-blue-500/30 transition-all group">
                <div class="flex flex-col sm:flex-row sm:items-start sm:justify-between gap-2 mb-3">
                  <div>
                    <h3 class="text-xl font-bold group-hover:text-blue-300 transition-colors uppercase tracking-tight">{item.role}</h3>
                    <p class="text-gray-400 text-base font-medium">{item.company}</p>
                  </div>
                  <span class="text-blue-400 text-sm font-mono bg-gray-900/80 px-3 py-1 rounded-full border border-gray-700 whitespace-nowrap self-start">
                    {item.date}
                  </span>
                </div>

                <p class="text-gray-300 text-base italic mb-4">{item.description}</p>
                
                <div class="grid gap-2">
                  {item.details.map((detail) => (
                    <div class="bg-gray-700/30 p-3 rounded-lg border-l-2 border-blue-500">
                      <h4 class="font-bold text-white text-sm mb-1">{detail.title}</h4>
                      <ul class="space-y-1">
                        {detail.content.split('\n').filter(line => line.trim() !== '').map(line => (
                          <li class="text-sm text-gray-300 leading-relaxed flex items-start gap-2">
                            <span class="text-blue-400 font-bold shrink-0 mt-0.5">›</span>
                            <span>{line.trim()}</span>
                          </li>
                        ))}
                      </ul>
                    </div>
                  ))}
                </div>

                <div class="flex flex-wrap gap-1.5 mt-4">
                  {item.tags.map((tag) => (
                    <span class={`px-2 py-0.5 text-xs rounded-md border ${colorMap[tag.color] || colorMap.blue}`}>
                      {tag.name}
                    </span>
                  ))}
                </div>
              </div>
            ))}
          </div>
        </section>
      ))}


    </main>
  </div>
</div>

<script>
  const links = document.querySelectorAll('.sidebar-link');
  const targets = document.querySelectorAll('[id]');
  
  function updateActive() {
    let current = '';
    targets.forEach(el => {
      const top = el.getBoundingClientRect().top;
      if (top <= 150) current = el.id;
    });
    
    links.forEach(link => {
      const isActive = link.getAttribute('data-section') === current;
      link.classList.toggle('text-white', isActive);
      link.classList.toggle('text-gray-500', !isActive && link.classList.contains('text-sm'));
      link.classList.toggle('text-gray-600', !isActive && !link.classList.contains('text-sm'));
      link.classList.toggle('text-gray-300', isActive && !link.classList.contains('text-sm'));
      link.classList.toggle('border-blue-500', isActive);
      link.classList.toggle('border-transparent', !isActive);
      link.classList.toggle('bg-gray-800/50', isActive && link.classList.contains('text-sm'));
    });
  }
  
  window.addEventListener('scroll', updateActive);
  updateActive();
</script>
