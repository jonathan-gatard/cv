---
// Lightbox component â€” included once in Layout, works globally on all <img> elements
---

<!-- Lightbox Modal -->
<div id="lightbox-overlay" class="fixed inset-0 z-[999] bg-black/90 backdrop-blur-sm hidden items-center justify-center cursor-zoom-out" role="dialog" aria-modal="true">
  <button class="absolute top-4 right-4 text-white/70 hover:text-white text-4xl font-light z-10 w-12 h-12 flex items-center justify-center" aria-label="Fermer">&times;</button>
  <img id="lightbox-img" class="max-w-[90vw] max-h-[90vh] object-contain rounded-lg shadow-2xl transition-transform duration-200" alt="" />
  <p id="lightbox-caption" class="absolute bottom-6 left-1/2 -translate-x-1/2 text-white/70 text-sm bg-black/50 px-4 py-2 rounded-full max-w-lg text-center truncate"></p>
</div>

<style>
  #lightbox-overlay.active {
    display: flex;
  }
  :global(img.lightbox-enabled) {
    cursor: zoom-in;
  }
</style>

<script>
  const overlay = document.getElementById('lightbox-overlay')!;
  const lightboxImg = document.getElementById('lightbox-img') as HTMLImageElement;
  const caption = document.getElementById('lightbox-caption')!;

  // Any img inside a passion page content area is lightbox-enabled
  // Exclude tiny icons (<48px) and images inside links
  document.querySelectorAll('img').forEach(img => {
    if (img.closest('nav') || img.closest('#navbar') || img.closest('a')) return;
    if (img.naturalWidth > 0 && img.naturalWidth < 48) return;
    
    img.classList.add('lightbox-enabled');
    img.addEventListener('click', () => {
      lightboxImg.src = img.src;
      caption.textContent = img.alt || '';
      caption.style.display = img.alt ? '' : 'none';
      overlay.classList.add('active');
      document.body.style.overflow = 'hidden';
    });
  });

  // Close on overlay click, button click, or Escape
  overlay.addEventListener('click', (e) => {
    if (e.target === overlay || (e.target as HTMLElement).tagName === 'BUTTON') {
      close();
    }
  });

  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && overlay.classList.contains('active')) {
      close();
    }
  });

  function close() {
    overlay.classList.remove('active');
    document.body.style.overflow = '';
  }
</script>
